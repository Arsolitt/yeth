# yeth

Утилита для построения графа зависимостей между приложениями и вычисления их хэшей.

## Как это работает

1. Сканирует директории в поисках файлов `yeth.toml`
2. Строит граф зависимостей между приложениями
3. Проверяет на циклические зависимости
4. Вычисляет хэш каждого приложения с учётом хэшей его зависимостей
5. Выводит результаты

## Установка

```bash
cargo build --release
```

Бинарник будет в `target/release/yeth`

## Использование

### Базовое использование

Вывести хэши всех приложений:

```bash
yeth
```

### Вывод хэша конкретного приложения

```bash
yeth --app my-app
```

### Вывод только хэша (без имени)

Полезно для скриптов:

```bash
yeth --app my-app --hash-only
```

### Указать корневую директорию

```bash
yeth --root /path/to/monorepo
```

### Показать граф зависимостей

```bash
yeth --show-graph
```

### Тихий режим (без статистики)

```bash
yeth --verbose
```

## Формат конфигурации

Создайте файл `yeth.toml` в корне каждого приложения:

```toml
[app]
dependencies = ["app1", "app2"]
```

Если у приложения нет зависимостей:

```toml
[app]
dependencies = []
```

## Примеры

### Структура проекта

```
monorepo/
├── app1/
│   ├── yeth.toml      # dependencies = []
│   └── src/
├── app2/
│   ├── yeth.toml      # dependencies = ["app1"]
│   └── src/
└── app3/
    ├── yeth.toml      # dependencies = ["app1", "app2"]
    └── src/
```

### Пример вывода

```bash
$ yeth
a1b2c3d4... app1
e5f6g7h8... app2
i9j0k1l2... app3

Время выполнения: 123.45ms
Обработано приложений: 3
```

### Использование в CI/CD

Получить хэш приложения для определения нужно ли его пересобирать:

```bash
#!/bin/bash
APP_HASH=$(yeth --app my-app --hash-only --verbose)
echo "Текущий хэш: $APP_HASH"

# Сравнить с сохранённым хэшом и решить нужна ли пересборка
if [ "$APP_HASH" != "$LAST_BUILD_HASH" ]; then
    echo "Изменения обнаружены, запускаем сборку..."
    # build commands here
fi
```

## Опции командной строки

```
Options:
  -r, --root <ROOT>      Корневая директория для поиска приложений [default: .]
  -a, --app <APP>        Имя конкретного приложения для вывода хэша
  -H, --hash-only        Показывать только хэш без имени приложения
  -v, --verbose            Не показывать статистику времени выполнения
  -g, --show-graph       Показать граф зависимостей
  -h, --help             Print help
```

## Архитектура

Проект разбит на модули:

- `cli.rs` - Парсинг аргументов командной строки (clap)
- `config.rs` - Чтение и парсинг конфигурационных файлов
- `graph.rs` - Построение графа зависимостей и топологическая сортировка
- `hash.rs` - Вычисление хэшей директорий и приложений
- `main.rs` - Точка входа и координация работы

## Алгоритм вычисления хэша

1. Для каждого приложения вычисляется собственный хэш (SHA256 всех файлов)
2. Приложения обрабатываются в топологическом порядке
3. Финальный хэш = SHA256(собственный_хэш + хэш_зависимости_1 + ... + хэш_зависимости_N)

Это гарантирует, что изменение в любой зависимости повлияет на хэш всех зависящих от неё приложений.
